# .pre-commit-config.yaml
repos:
  - repo: local
    hooks:
      - id: strip-co-authored
        name: Strip Co-Authored-By trailers with Claude
        entry: bash -c 'sed -i "/^Co-Authored-By:.*Claude/d" "$1"' --
        language: system
        stages: [prepare-commit-msg, commit-msg]
        pass_filenames: true

      # Prevent commits with AI attribution
      - id: check-commit-message
        name: Check commit message for AI attribution
        entry: |
          bash -c 'msg=$(cat "$1"); if echo "$msg" | grep -qE "(Claude Code|Co-Authored-By:.*Claude)"; then echo "‚ùå Commit rejected: Cannot include Claude attribution"; echo ""; echo "Commit messages must not include Claude tool attribution."; echo ""; echo "Please edit your commit message and try again."; exit 1; fi'
        language: system
        stages: [commit-msg]
        pass_filenames: true

      # Run fixers automatically before each commit
      - id: poe-fix
        name: Run Poe 'fix'
        entry: |
          bash -c 'export PATH="$HOME/.local/bin:$PATH"; poetry run poe fix'
        language: system
        pass_filenames: false
        stages: [pre-commit]

      # Run checks (no auto-fixing) before pushing
      - id: poe-check
        name: Run Poe 'check'
        entry: |
          bash -c 'export PATH="$HOME/.local/bin:$PATH"; poetry run poe check'
        language: system
        pass_filenames: false
        stages: [pre-push]
